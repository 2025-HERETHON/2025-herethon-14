const cards = [
  {
    username: "김** 님",
    title: "여러분의 잘못이 아니에요",
    content:
      "처음엔 그냥 제가 예민한 줄 알았어요 ㅠㅠ \n 하루 종일 연락 안 받았다고 혼나는 것도, 친구랑 만났다고 화내는 것도, 다 “나를 너무 사랑해서” 그런 줄 알았거든요.\n 근데 이상하게도, 자꾸만 내가 작아지는 기분이 들었어요. 말을 아끼게 되고, 표정을 조심하게 되고, 어느 순간부터는 내가 무슨 생각을 하고 있는지도 잘 모르겠더라고요.\n 그래도 헤어질 정도까진 아니야라는 생각을 많이 했어요. 그런데 어느 날, 친구한테 그 사람이 했던 말을 흘려 얘기했는데 친구가 갑자기 정색하면서 말했어요. \n그건 사랑이 아니라 통제야. 그 말이 머리를 세게 때렸어요. 그날 이후로 천천히 거리를 두기 시작했고, 상담센터도 찾아가 봤고, 결국 이별도 했어요. \n물론 쉬운 과정은 아니었어요. 무서웠고, 죄책감도 들었고요.\n하지만 지금은,  그때의 나를 구한 건 나 자신이었다는 걸 믿고 있어요. \n혹시 여러분들도 스스로를 자꾸만 의심하고 있다면, 그건 여러분의 잘못이 아닐 수 있다는 걸 먼저 말해주고 싶어요" ,
    date: "2025.07.02",
    isScrapped: false,
  },
  {
    username: "이** 님",
    title: "이제는 웃고 있어요",
    content:
      "이제는 웃고 있어요\n\n안녕하세요.\n많이 망설였지만, 저 같은 사람이 또 있을까 봐 용기 내어 글을 써요.\n저는 최근에 오랜 연애를 끝냈고, 그 사람으로부터 고소와 접근금지 조치도 마친 상태입니다.\n\n저희는 처음엔 정말 잘 맞았어요. 말도 잘 통하고, 취향도 비슷했고요.\n근데 이상하게도 시간이 갈수록 제가 점점 ‘배려받지 못한다’는 느낌이 들기 시작했어요.\n보고 싶다고 하면 바쁘다 하고, 전화하자 하면 피곤하다고 하더라고요.\n\n처음엔 \"내가 너무 기대했나?\" 싶었어요.\n근데 아무리 맞춰도, 그 사람은 계속 저를 당연하게 대했어요.\n제 생일에 연락 한 통 없이 넘어가도, \"그럴 수도 있지\" 하고 이해하려고 했고요.\n\n결국 저 혼자만 애쓰는 관계가 되어 있었어요.\n무시당하고 외면당하면서도\n‘그래도 얘가 나를 싫어하는 건 아닐 거야’라고 스스로를 속였던 것 같아요.\n\n하지만 마지막엔, 너무 큰 상처를 받고 나서야 정신이 들었어요.\n저는 그 사람이 아닌, 저 자신을 챙기기로 마음먹었고,\n상담도 받고, 법적인 절차도 밟았어요.\n쉬운 길은 아니었지만, 지금은 정말 잘했다고 생각해요.",
    date: "2025.07.01",
    isScrapped: false,
  },
  {
    username: "박** 님",
    title: "처음 쓴 탈출기",
    content:
      "처음엔 그냥 다 그런 줄 알았어요.\n 연락이 끊겨도, 약속이 자주 깨져도, '바쁜가보다' 하고 넘겼어요.\n 근데 점점 내가 그 사람 눈치를 보고 있다는 걸 깨달았어요. 나도 모르게 말투를 조심하고, 불편하다는 말도 못 하겠더라고요.\n 한번은, 아프다고 했더니 '그게 무슨 핑계냐'는 말을 들었어요. 그 순간, 마음 한켠이 툭 부서지는 느낌이었어요.\n 그날 이후로 제가 쓴 메모장을 다시 읽어봤어요. 서운했던 날들, 울면서 적은 말들, 다 남아 있더라고요.\n 그게 제 첫 번째 탈출기였어요. '이건 사랑이 아니구나'라고, 비로소 나 자신에게 말해준 순간이요.\n 이후로는 힘들었지만, 하나씩 정리를 해나갔어요. 번호도 지우고, 습관처럼 켜던 대화창도 닫고요.\n 지금은 다시 나를 챙기고 있어요. 잘 먹고, 잘 자고, 잘 웃고요.\n 혹시 누군가에게 갇혀 있는 기분이 든다면, 그건 당신 탓이 아니에요.\n 저처럼, 탈출해도 돼요. 아니, 탈출해야 해요. 나를 위해서.",
    date: "2025.06.30",
    isScrapped: false,
  },
  {
    username: "최** 님",
    title: "도망친 곳에 낙원은 있다",
    content:
      "그땐 도망치는 내가 비겁한 줄 알았어요.\n 자꾸 감정을 숨기게 되고, 불편하다는 말조차 하지 못한 채로 버텼어요.\n 싸움은 점점 거칠어졌고, 사과는 점점 없어졌어요. 그래도 '사랑하니까'라는 말로 모든 걸 덮으려 했죠.\n 하루에도 몇 번씩 마음이 부서졌지만, 그 사람은 몰랐어요. 아니, 알아도 신경 쓰지 않았던 것 같아요.\n 어느 날은 버스를 타고 가다가 문득 생각했어요. '이렇게까지 해서 사랑을 해야 하나?' 그게 제 한계였어요.\n 결국 저는 짐을 싸서 나왔고, 연락도 끊었어요. 도망치듯 빠져나온 그 순간이 얼마나 무서웠는지 몰라요.\n 근데요, 이상하게 그 이후부터 숨이 쉬어졌어요. 친구들과 웃고, 아침에 눈을 뜨는 게 덜 무거워졌어요.\n 낙원은 멀리 있는 줄 알았는데, 알고 보니 그곳은 내가 나를 지키기로 한 그 자리였어요.\n 혹시 지금 도망치고 싶은 마음이 있다면, 그건 당신 안의 작은 SOS일지도 몰라요.\n 저는 그 마음을 따라갔고, 지금은 정말 평화롭게 살고 있어요.",
    date: "2025.06.13",
    isScrapped: false,
  },
  {
    username: "정** 님",
    title: "그때의 나는 몰랐어요",
    content:
      "그때의 나는 몰랐어요.\n 하루 종일 눈치를 보는 게 사랑일 리 없다는 걸요.\n 톤을 낮춰 말하고, 감정을 삼키고, 내 기분은 늘 뒷전이었는데도 '연애란 원래 이런 거겠지' 하고 넘겼어요.\n 친구들과의 약속도 줄이고, 하고 싶던 일도 미뤘어요. 그 사람이 싫어할까 봐요.\n 그런데 이상하게도, 점점 내가 사라지는 기분이 들었어요.\n\n한참이 지나서야 알았어요. 그건 사랑이 아니라, 나를 깎아내리는 관계였다는 걸요.\n 그때는 그저 잘 맞춰보려 했지만, 지금 돌아보면 그건 내가 나를 버리고 있었던 시간이었어요.\n 이별은 아팠지만, 저를 다시 찾아오는 길이기도 했어요.\n 지금은 하고 싶던 일을 다시 시작했고, 예전보다 훨씬 단단해졌어요.\n\n혹시 지금, 그 사람의 기분에만 모든 걸 맞추고 있다면 잠시 멈춰서 자신에게 물어보세요.\n 진짜 나를 아껴주는 사랑이 맞는지.\n 그때의 나는 몰랐지만, 지금의 나는 분명히 알아요.",
    date: "2025.06.11",
    isScrapped: false,
  },
  {
    username: "강** 님",
    title: "그 사람 없이도 괜찮아요",
    content:
      "이별하기 전엔 정말 무서웠어요.\n 그 사람 없이 내가 뭘 할 수 있을까, 하루라도 버틸 수 있을까 싶었거든요.\n 늘 함께였던 시간이 많았던 만큼, 그 공백이 나를 집어삼킬 것 같았어요.\n 그런데 막상 끝내고 나니, 이상하게도 마음이 조용해졌어요.\n\n더 이상 울지 않았고, 눈치 보며 말하지 않아도 됐고, 혼자 있는 시간이 오히려 편안했어요.\n 그 사람이 있던 자리엔 이제 내가 있어요. 좋아하는 음악도 다시 듣고, 하고 싶었던 것도 하나씩 해보고 있어요.\n\n예전엔 '그 사람 없으면 안 된다'고 믿었는데, 지금은 알아요.\n **나 없이는 안 되는 사람은, 결국 나 자신이었단 걸요.**\n\n혹시 지금 누군가 때문에 버티고 있다면, 꼭 기억해 주세요.\n 그 사람 없이도 괜찮아요. 아니, 어쩌면 더 괜찮을지도 몰라요.",
    date: "2025.06.02",
    isScrapped: false,
  },
  {
    username: "조** 님",
    title: "내가 나를 구했어요",
    content:
      "그 사람을 좋아했던 건 사실이에요.\n 그래서 참 많이도 참았어요. 모진 말도, 예고 없는 잠수도, 이유 없는 차가움도요.\n 스스로를 설득했어요. '다들 힘든 시기가 있겠지', '내가 좀 더 이해하면 되겠지' 하고요.\n 근데 어느 순간, 거울을 봤는데 제 얼굴에 생기가 없더라고요.\n 웃는 법을 잊은 사람 같았어요.\n\n그때 처음으로 생각했어요. 내가 날 이렇게까지 해야 하나?\n 그 질문이 제 안에서 계속 맴돌았고, 결국 저는 용기를 냈어요.\n 관계를 끝내고, 스스로를 돌보기 시작했어요. 익숙했던 외로움 대신, 새로운 평온이 찾아왔고요.\n\n지금은 확실히 말할 수 있어요.\n 그 사람도 아니고, 누구의 위로도 아닌,\n **내가 나를 구했다고요.**\n\n혹시 지금, 마음 한 켠에서 작은 목소리가 들린다면 무시하지 마세요.\n 그게 바로, 스스로를 구하라는 신호일지도 몰라요.",
    date: "2025.05.02",
    isScrapped: false,
  },
  {
    username: "윤** 님",
    title: "사랑인 줄 알았던 것들",
    content:
      "사랑인 줄 알았어요.\n 나를 걱정해서 연락을 자주 하라고 했던 것도,\n 다른 사람이랑 어울리는 걸 싫어했던 것도,\n 내 옷차림을 하나하나 간섭했던 것도요.\n 그땐 그 모든 게 '나를 좋아하니까'라고 믿었어요.\n\n근데 시간이 지날수록 이상했어요.\n 왜 내 일상이 점점 줄어들고, 말수가 적어지고, 표정이 굳어지는 걸까.\n 자꾸만 내 안의 내가 사라지는 기분이 들었어요.\n\n결국 그 관계에서 나왔고, 혼자 남겨졌을 때 깨달았어요.\n 그건 사랑이 아니라, 두려움이었어요. 내가 잃을까봐 두려워서 참고 있던.\n\n이제는 다시 나를 채워가고 있어요.\n 사랑인 줄 알았던 것들 사이에서, 진짜 나를 찾아가는 중이에요.\n\n혹시 지금, 사랑이라는 이름 아래 무너지고 있다면\n그건 분명, 다시 들여다봐야 할 감정이에요.",
    date: "2025.05.02",
    isScrapped: false,
  },
  {
    username: "강** 님",
    title: "울지 않는 하루가 오더라고요",
    content:
      "그땐 정말 매일 울었어요.\n 별일 아닌 말에도 상처받고, 아무 일 없는 날에도 불안했어요.\n 무슨 말을 해도 돌아오는 건 비난이었고, 무슨 행동을 해도 눈치를 줬어요.\n 나를 사랑한다고 말하면서, 정작 나를 아프게 하는 건 그 사람이었어요.\n\n그런데도 쉽게 벗어나지 못했어요. 익숙해졌거든요. 내가 참고 이해하는 게 당연하다고 믿었으니까요.\n 하지만 어느 순간, 눈물이 마를 날이 없다는 게 이상하다고 느껴졌어요. '이게 사랑이 맞을까?' 처음으로 그 생각이 들었어요.\n\n용기를 내서 그 관계에서 나왔고, 처음엔 무서웠지만 조금씩 숨통이 트이기 시작했어요.\n 그리고 얼마 전, 문득 깨달았어요. 오늘은 울지 않았다는 걸.\n\n매일 울던 내가, 이제는 울지 않는 하루를 살아가고 있어요.\n 혹시 지금 매일 울고 있다면, 그건 분명히 사랑이 아니에요.\n 나를 아프게 하는 곳에서 벗어나도 괜찮아요. 울지 않는 하루는 반드시 오더라고요.",
    date: "2025.04.02",
    isScrapped: false,
  },
];

document.addEventListener("DOMContentLoaded", () => {
  const saved = JSON.parse(localStorage.getItem("scrappedCards")) || [];
  cards.forEach((card) => {
    card.isScrapped = saved.some(
      (savedCard) =>
        savedCard.title === card.title &&
        savedCard.username === card.username &&
        savedCard.date === card.date
    );
  });
  renderCards(cards);

  // 현재 페이지에 따라 글씨 색 바꾸기
  const path = window.location.pathname;
  const allBtn = document.getElementById("allBtn");
  const scrapBtn = document.getElementById("scrapBtn");

  if (path.includes("exitlog.html")) {
    allBtn?.classList.add("active");
  } else if (path.includes("scrap.html")) {
    scrapBtn?.classList.add("active");
  }

  // 클릭 시 페이지 이동
  allBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    window.location.href = "exitlog.html";
  });

  scrapBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    window.location.href = "scrap.html";
  });
});

// 스크랩 버튼 클릭
document.addEventListener("click", function (e) {
  const button = e.target.closest(".scrap-icon");
  if (!button) return;

  const index = button.dataset.index;
  cards[index].isScrapped = !cards[index].isScrapped;

  const img = button.querySelector("img");
  img.src = `/static/assets/${cards[index].isScrapped ? "scrap.png" : "nonscrap.png"}`;

  const scrappedCards = cards.filter((card) => card.isScrapped);
  localStorage.setItem("scrappedCards", JSON.stringify(scrappedCards));
});

// 정렬 선택 함수
function selectSort(option) {
  if (option === "최신순") {
    sortPosts("new");
  } else if (option === "오래된 순") {
    sortPosts("old");
  }
  document.getElementById("sortPopup").style.display = "none";
  document.querySelector(".sort-trigger").innerHTML = `${option} <span class="arrow"><img src="/static/assets/Vector.png" alt="down"/></span>`;
}

function sortPosts(order) {
  cards.sort((a, b) => {
    const d1 = new Date(a.date.replace(/\./g, "-"));
    const d2 = new Date(b.date.replace(/\./g, "-"));
    return order === "old" ? d1 - d2 : d2 - d1;
  });
  renderCards(cards);
}

toggleSort = () => {
  const popup = document.getElementById("sortPopup");
  popup.style.display = popup.style.display === "block" ? "none" : "block";
};

window.addEventListener("click", function (e) {
  const popup = document.getElementById("sortPopup");
  const trigger = document.querySelector(".sort-trigger");
  if (!popup.contains(e.target) && !trigger.contains(e.target)) {
    popup.style.display = "none";
  }
});

// 사이드바 필터링
const allBtn = document.getElementById("allBtn");
const scrapBtn = document.getElementById("scrapBtn");

allBtn?.addEventListener("click", () => {
  renderCards(cards);
  document.querySelectorAll(".sidebar-menu li").forEach((li) => li.classList.remove("active"));
  allBtn.parentElement.classList.add("active");
});

scrapBtn?.addEventListener("click", () => {
  const saved = JSON.parse(localStorage.getItem("scrappedCards")) || [];
  renderCards(saved);
  document.querySelectorAll(".sidebar-menu li").forEach((li) => li.classList.remove("active"));
  scrapBtn.parentElement.classList.add("active");
});

// 카드 클릭 시 상세 페이지 이동
function renderCards(cardsArray) {
  const container = document.querySelector(".escape-card-grid");
  container.innerHTML = "";

  cardsArray.forEach((card, index) => {
    const cardHtml = `
      <div class="escape-card" data-index="${index}">
        <div class="card-header">
          <div class="profile-img"><img src="/static/assets/profile.svg" alt="프로필 이미지" /></div>
          <div class="user-name">${card.username}</div>
          <button class="scrap-icon" data-index="${index}">
            <img src="/static/assets/${card.isScrapped ? "scrap.png" : "nonscrap.png"}" />
          </button>
        </div>
        <div class="card-body">
          <div class="card-title">${card.title}</div>
          <div class="card-content">${card.content}</div>
        </div>
        <div class="card-date">${card.date}</div>
      </div>
    `;
    container.insertAdjacentHTML("beforeend", cardHtml);
  });

  document.querySelectorAll(".escape-card").forEach((cardEl, idx) => {
    cardEl.addEventListener("click", (e) => {
      if (e.target.closest(".scrap-icon")) return;
      const selectedCard = cardsArray[idx];
      localStorage.setItem("selectedCard", JSON.stringify(selectedCard));
      window.location.href = "exitlog_post.html";
    });
  });
}  
